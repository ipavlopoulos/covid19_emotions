<head>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
</head>

<!--div id="positive_div" style="width:600px;height:250px;"></div-->
<!--div id="negative_div" style="width:600px;height:250px;"></div-->
<!--script>
    var pos_data = [{y: [0.1, 0.2, 1, 4, 10], x: ['2020-07-01', '2020-07-15','2020-08-1', '2020-08-15'], line: {color: 'green'}}]
    var neg_data = [{y: [5, 4, 2, 0.5, 0.01], x: ['2020-07-01', '2020-07-15','2020-08-1', '2020-08-15'], line: {color: 'red'}}]
	Plotly.newPlot(document.getElementById('positive_div'), pos_data, {title: 'Positive Sentiment',} );
	Plotly.newPlot(document.getElementById('negative_div'), neg_data, {title: 'Negative Sentiment',} );

</script-->

<!--script>
    Plotly.d3.csv('https://raw.githubusercontent.com/apodagrosi/datasets/master/PlotlyTest_Summary_SalesByDealerByYear.csv', (err, rows) => {
        var data = years.map(y => {
            var d = rows.filter(r => r.year === y)

            return {
                type: 'bar',
                name: y,
                x: d.map(r => r.dealer),
                y: d.map(r => r.sales)
            }
        })
    }
</script-->

<head>
    <!-- Plotly.js -->
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
</head>

<body>
<a href="?state=Arizona" class="btn btn-light">Arizona</a>
<a href="?state=New York" class="btn btn-light">New York</a>
<a href="?state=California" class="btn btn-light">California</a>
<a href="?state=Texas" class="btn btn-light">Texas</a>
<a href="?state=New Jersey" class="btn btn-light">New Jersey</a>
<a href="?state=Washington" class="btn btn-light">Washington</a>
<a href="?state=Massachusetts" class="btn btn-light">Massachusetts</a>
<a href="?state=Minnesota" class="btn btn-light">Minnesota</a>

<div id="myDiv" style="width: 100%;"><!-- Plotly chart will be drawn inside this DIV --></div>
<footer style="font-family:courier;position:absolute;bottom:0;right:10px;">&copy; Copyright 2020 J. Pavlopoulos</footer>
<script>
    const queryString = window.location.search;
    const urlParams = new URLSearchParams(queryString);
    const state = urlParams.get('state')
    const url = "https://raw.githubusercontent.com/ipavlopoulos/emotions/master/docs/DATA/"+state+".csv";
    function makeplot() {
        Plotly.d3.csv(url, function (data) {
            processData(data)
        });
    };

    function changeState(value){
        urlParams.set("state", value);
        window.location.search = urlParams.toString();
        alert(urlParams.get("state"));
        window.location.reload();
    }

    function processData(allRows) {

        console.log(allRows);
        var x = [], y = [], standard_deviation = [];

        for (var i = 0; i < allRows.length; i++) {
            row = allRows[i];
            x.push(row['day']);
            y.push(row['positive']);
        }
        console.log('X', x, 'Y', y, 'SD', standard_deviation);
        makePlotly(x, y, standard_deviation);
    }

    function makePlotly(x, y, standard_deviation) {
        var plotDiv = document.getElementById("plot");
        var traces = [{
            x: x,
            y: y
        }];

        Plotly.newPlot('myDiv', traces,
            {title: 'Twitter positive sentiment in '+state});
    };
    makeplot();
</script>
</body>
